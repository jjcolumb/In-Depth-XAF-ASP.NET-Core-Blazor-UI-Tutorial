# In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial

While we continue to extend the capabilities of XAF’s ASP.NET Core Blazor UI, you can deliver intuitive user experiences for the ASP.NET Core Blazor platform today. This tutorial documents how to build an application to store contacts and other related objects using XAF’s ASP.NET Core Blazor UI. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/9792ce26-5370-4919-bb95-eeefe1cc834b)

If you are new to XAF, be sure to review our XAF product page for important background information on our award-winning application framework.

## Dependencies and Prerequisites
Before you start the tutorial, read this section and ensure that the following conditions are met: 

1. Visual Studio 2022 v17.0+ (with the ASP.NET and web development workload) is installed on your machine. You have basic experience of .NET framework development in this IDE. 
2. .NET 6 SDK is installed on your machine. 
3. A free 30-day trial version or a licensed version of DevExpress Universal Subscription is installed on your machine. 
4. You have basic knowledge of Object-relational mapping (ORM) concepts and the DevExpress XPO. 
5. Any RDBMS supported by the XPO ORM tool (see Database Systems Supported by XPO) is installed and accessible from your machine to store the application data (a LocalDB or SQL Server Express instance is recommended). 
6. You are familiar with XAF application architecture. 

## Tutorial Structure
This tutorial is organized in the following manner: 

* Business Model Design

This section explains how to implement classes that define the foundation of your application’s business model and its associated database structure.

* Extend Functionality

This section explains how to extend XAF’s autogenerated UI with custom commands.

* UI Customization

This section explains how to customize XAF’s autogenerated ASP.NET Core Blazor application UI.

## Connection String
This tutorial uses Microsoft’s SQL Server as its target database management system (DBMS). As you may already know, XAF supports multiple database management systems (see the list here). If you’d like to use a different DBMS, be sure to specify the appropriate connection string.

XAF apps create a database with a name that matches the name used for the solution itself. To change names, edit the connection string in the application configuration file (appsettings.json).

To recreate your database, drop it from the database server or remove the file. Your XAF application will recreate the database at next startup.

# Business Model Design
This section explains how to design a business model (database) for an application built with the eXpressApp Framework. 

You will learn how to complete the following tasks:

* Create business classes mapped to database tables 
* Specify relationships between classes 
* Implement dependent properties 
* Add property value validation 

You can design a business model in any of the following ways:

* Use the DevExpress Business Class Library

The Business Class Library includes frequently used business classes, such as Person, Event, Task, etc. You can use a class from this library as is, or inherit and extend it.

* Build Custom Classes

If you use XPO, inherit your business objects from Base Persistent Classes.

> TIP: For information on how to build an application based on an existing database, refer to the following topic: How to: Generate XPO Business Classes for Existing Data Tables.

Once you complete the tutorial, your basic ASP.NET Core Blazor CRUD application will look as shown in the image below.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/c2e7c254-8cb0-4e34-a0e4-f9cbb1469e86)

## Create a Solution (XPO)
This lesson creates a new XAF solution and guides you through the XAF Solution Wizard. In the Wizard, you will do the following: 

* Add a Blazor UI project to the solution. 
* Select an ORM tool to use for data management. 
* Turn on user authentication. 
* Review available built-in modules and enable the Validation module. 

At the end of this lesson, you can run the application for the first time.

### Step-by-Step Instructions
1. From Visual Studio’s main menu, select File | New | Project… to invoke the Create a new project dialog.

2. Select DevExpress v22.1 XAF Template Gallery and click Next. Specify the project’s name (“MySolution”) and click Create.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/8a2fce33-7176-428e-b60f-395a6631a938)

3. In the invoked Template Gallery window, switch to the .NET Core section. Select XAF Solution Wizard (.NET Core) and click Run Wizard.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/c1af0c11-5ed4-417e-b88e-ccce3b083f5f)

4. On the first page of the Solution Wizard, you can select the target platform. Since this tutorial only demonstrates the Blazor UI, select the Web (ASP.NET Core Blazor) option and click Next.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/445e10d7-f984-442b-bbbc-d19ae851e470)

5. Choose the DevExpress eXpress Persistent Objects ORM library.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/fe749992-2fc1-4775-9694-df100acae5a6)

6. Choose the authentication type for your application. In this tutorial, we use Standard. Click Next.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/99228f56-6d88-44dd-945f-0eaa043f4549)

7. Select the ready-to-use XAF modules you want to add to your application. This tutorial requires the Validation module. Click Finish.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/6156fc02-017d-4d36-a45b-395644c75010)

The solution contains the following projects: 

* **MySolution.Blazor.Server** - the ASP.NET Core Blazor application project that automatically generates the ASP.NET Core Blazor CRUD user interface. This project depends on the MySolution.Module. 
* **MySolution.Module** - the module project that contains platform-independent code.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/be5561d4-03f6-41fd-9af3-e6b78bba736e)
Refer to the Application Solution Structure topic for information on the XAF solution structure.

8. You can now run the application. Click Start Debugging or press F5.

The following images show the resulting ASP.NET Core Blazor application. Log in as “Admin” and use an empty string as the password.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/88c4a55c-1b4d-44ef-86ce-83febfa9a6ca)
![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/8ec3e04e-7e4c-433a-b3ad-e4cb37630036)

### Initial Connection to Database
The wizard attempts to find the installed Microsoft SQL Server instance (LocalDB or Express) and sets the connection string accordingly. 

Refer to the Connect an XAF Application to a Database Provider topic for details on how to connect to different database systems.

## Inherit from the Business Class Library Class (XPO)
In this lesson, you will learn how to implement business classes for your application using the Business Class Library. This library contains the most typical ready-to-use business classes. You will implement a custom Contact class by deriving from the Person class available in this library, and implement several additional properties. You will also learn the basics of automatic user interface construction based on data.

### Step-by-Step Instructions
1. Right-click the Business Objects folder in the MySolution.Module project, and choose Add Item | Class…, specify Contact.cs as the new class name and click Add. 
2. Replace the generated class declaration with the following code.

```csharp
using DevExpress.Persistent.Base;
using DevExpress.Persistent.BaseImpl;
using DevExpress.Persistent.Validation;
using DevExpress.Xpo;
using System;

namespace MySolution.Module.BusinessObjects {
    [DefaultClassOptions]
    public class Contact : Person {
        public Contact(Session session) : base(session) { }
        private string webPageAddress;
        public string WebPageAddress {
            get { return webPageAddress; }
            set { SetPropertyValue(nameof(WebPageAddress), ref webPageAddress, value); }
        }
        private string nickName;
        public string NickName {
            get { return nickName; }
            set { SetPropertyValue(nameof(NickName), ref nickName, value); }
        }
        private string spouseName;
        public string SpouseName {
            get { return spouseName; }
            set { SetPropertyValue(nameof(SpouseName), ref spouseName, value); }
        }
        private TitleOfCourtesy titleOfCourtesy;
        public TitleOfCourtesy TitleOfCourtesy {
            get { return titleOfCourtesy; }
            set { SetPropertyValue(nameof(TitleOfCourtesy), ref titleOfCourtesy, value); }
        }
        private DateTime anniversary;
        public DateTime Anniversary {
            get { return anniversary; }
            set { SetPropertyValue(nameof(Anniversary), ref anniversary, value); }
        }
        private string notes;
        [Size(4096)]
        public string Notes {
            get { return notes; }
            set { SetPropertyValue(nameof(Notes), ref notes, value); }
        }
    }
    public enum TitleOfCourtesy { Dr, Miss, Mr, Mrs, Ms };
}
```
3. Run the application. 

XAF generates a user interface that is based on the specified data structures: 

* a List View

List View displays the Contact list. If users click the New button or click an existing record, the application shows a detail form (Detail View) filled with editors for each data field. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/1f6ad8f8-24de-491d-a107-258fb41abaf1)

* a Detail View

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/9df1df0f-e219-4b2b-bea8-8f3987d9a5b1)

### Detailed Explanation
#### Convention
Typically, business classes do not depend on application UI and should be implemented in a platform-independent module project. Business objects can be shared with other XAF or non-XAF applications.

#### Add a Business Object
In this lesson, we derive the Contact object from the Person class. The Person class is one of the Business Class Library classes. This class already contains fields specific to entities of the Person type: first name, last name, birth date, etc. 

The Person class (and the rest of the Business Class Library) derives from BaseObject. The BaseObject class derives from DevExpress.Xpo.XPCustomObject - one of the base classes in XPO. This means that the Contact business object is a persistent object.

XPO requires that you implement property setters and a parameterized constructor as follows:

```csharp
[DefaultClassOptions]
public class Contact : Person {
    public Contact(Session session) : base(session) { }
    private string webPageAddress;
    public string WebPageAddress {
        get { return webPageAddress; }
        set { SetPropertyValue(nameof(WebPageAddress), ref webPageAddress, value); }
    }
    // ...
}
```
Refer to the following help topic for more information: Creating a Persistent Object.

For a general business class concept overview, refer to the following topic: Business Classes vs Database Tables.

> NOTE: CodeRush includes a number of Code Templates that help generate business classes or their parts with a few keystrokes. To learn about the Code Templates for eXpress Persistent Objects, refer to the following help topic: XPO and XAF Templates.

#### Attributes
In this tutorial the business objects class is decorated with the DefaultClassOptionsAttribute attribute. This attribute means that the following capabilities are available for the Contact business class.

* The Contact item is added to the main page’s navigation control. Users can click this item to access the associated List View. 
![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/3bdf44e6-3cbe-46c7-94ac-d94a5197ba97)

* Contact objects can be used as a data source to generate reports (see Create a Report in Visual Studio). 
To apply each of these options separately, use the `NavigationItemAttribute` and `VisibleInReportsAttribute` attributes.

#### User Interface
XAF generates the appropriate editors for data fields in the List View and Detail View. For example, a date picker is generated for date-time values, a combo box editor is created for Title Of Courtesy (an enumerator).

XAF transforms captions from camel-case to space-separated strings, form titles are updated, etc.

You can use the grid features in a List View at runtime: rearrange columns, and sort and filter data.

## Supply Initial Data (XPO)

### Step-by-Step Instructions
1. Open the Updater.cs file located in the MySolution.Module project’s Database Update folder. Add the following code to the `ModuleUpdater.UpdateDatabaseAfterUpdateSchema` method.

```csharp
using MySolution.Module.BusinessObjects;
//...

public class Updater : DevExpress.ExpressApp.Updating.ModuleUpdater {
    //...
    public override void UpdateDatabaseAfterUpdateSchema() {
        base.UpdateDatabaseAfterUpdateSchema();

        Contact contactMary = ObjectSpace.FirstOrDefault<Contact>(contact => contact.FirstName == "Mary" && contact.LastName == "Tellitson"); 
        if (contactMary == null) {
            contactMary = ObjectSpace.CreateObject<Contact>();
            contactMary.FirstName = "Mary";
            contactMary.LastName = "Tellitson";
            contactMary.Email = "tellitson@example.com";
            contactMary.Birthday = new DateTime(1980, 11, 27);
        }
        //...
        ObjectSpace.CommitChanges();
    }
}
```

2. Run the application. Select the Contact item in the navigation control. Notice that the new contact, “Mary Tellitson”, appears on the list to the right.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/d5a4946b-82a7-4e13-aba1-5c4aea715714)

### Detailed Explanation
#### Database Update
In step 1, you add a code that checks whether the contact list contains an entry that matches the name “Mary Tellitson”. If such a contact does not exist, the code creates and adds it to the database.

An XAF application checks application and database version compatibility on each start. The following checks are performed:

* The database exists. 
* All required tables exist. 
* All required columns exist. 
The `XafApplication.DatabaseVersionMismatch` event occurs if any of these checks fails.

The ASP.NET Core Blazor application handles this event in a solution template. When the application runs in debug mode, this event handler uses the built-in Database Updater to update the application’s database. After the database schema is updated, the` ModuleUpdater.UpdateDatabaseAfterUpdateSchema` method is called. In this method, you can save the required business objects to the database.

#### Query Data
As you can see in the code above, XAF uses an Object Space object to manipulate persistent objects (see Create, Read, Update and Delete Data).

## Implement Custom Business Classes and Reference Properties (XPO)
This lesson explains the following concepts:

* How to implement business classes from scratch 
* How to implement object references to existing classes 
* How XAF generates UI for referenced objects 

### Step-by-Step Instructions
1. Add the following Department and Position persistent classes to the Contact.cs file.

```csharp
namespace MySolution.Module.BusinessObjects {
    // ...    
    [DefaultClassOptions]
    [System.ComponentModel.DefaultProperty(nameof(Title))]
    public class Department : BaseObject {
        public Department(Session session) : base(session) { }
        private string title;
        public string Title {
            get { return title; }
            set { SetPropertyValue(nameof(Title), ref title, value); }
        }
        private string office;
        public string Office {
            get { return office; }
            set { SetPropertyValue(nameof(Office), ref office, value); }
        }
    }
    [DefaultClassOptions]
    [System.ComponentModel.DefaultProperty(nameof(Title))]
    public class Position : BaseObject {
        public Position(Session session) : base(session) { }
        private string title;
        public string Title {
            get { return title; }
            set { SetPropertyValue(nameof(Title), ref title, value); }
        }
    }
}
```

2. Add the Department and Position properties to the Contact class:

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    private Department department;
    public Department Department {
        get {return department;}
        set {SetPropertyValue(nameof(Department), ref department, value);}
    }
    private Position position;
    public Position Position {
        get {return position;}
        set {SetPropertyValue(nameof(Position), ref position, value);}
    }
    //...
}
```

The Contact class now exposes the Position and Department reference properties.

3. Run the application. 

After you run the application you can see that the navigation control displays two new items: Department and Position. You can click the new items to access department and position lists.

* Department detail form:
![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/6104a7a2-3e1b-4b10-bbc8-2e59e9461a22)

* Department list:

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/c11de21b-e4c9-4f65-aa57-bd086ca33308)

In the Contact Detail View, XAF creates lookup editors for Department and Position. These editors use a special type of View - Lookup List View. Typically, this View includes a single column that displays values from the class’s default property. See additional information about default properties later in this topic. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/180e4288-b599-4ea9-ba79-5e2504602ed4)

Users can select Department or Position values from the dropdown lists. Note that Lookup editors support incremental filtering.

### Detailed Explanation
#### Default Property
The Position and Department classes are decorated with the DefaultProperty attribute. This attribute specifies the default property of the class. You can specify the most descriptive property of your class in the DefaultProperty attribute, and its values will then be displayed in the following:

* Detail form captions 
* The leftmost column of a List View 
* Lookup List Views 
Refer to the Data Annotations in Data Model topic for more information.

## Set a Many-to-Many Relationship (XPO)
This lesson explains how to create a many-to-many relationship between business objects and how XAF generates the UI for such relationships.

### Step-by-Step Instructions
1. Right-click the Business Objects folder in the MySolution.Module project, and choose Add | Class…. Change the file name to Task.cs and click Add. Replace the new file’s content with the following code:

```csharp
using DevExpress.ExpressApp.Model;
using DevExpress.Persistent.Base;
using DevExpress.Persistent.BaseImpl;
using DevExpress.Xpo;

namespace MySolution.Module.BusinessObjects {
    [DefaultClassOptions]
    [ModelDefault("Caption", "Task")]
    public class DemoTask : Task {
        public DemoTask(Session session) : base(session) { }
        [Association("Contact-DemoTask")]
        public XPCollection<Contact> Contacts {
            get {
                return GetCollection<Contact>(nameof(Contacts));
            }
        }
    }
}
```

2. Add the Tasks property in the Contact class implementation.

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    [Association("Contact-DemoTask")]
    public XPCollection<DemoTask> Tasks {
        get {
            return GetCollection<DemoTask>(nameof(Tasks));
        }
    }
}
```

3. Run the application. 

In the Contact detail view, the application displays the following elements:
    1. A list of assigned tasks;
    2. The New button - allows users to add a new assigned task; 
    3. The Link button - allows users to assign the current contact an existing task.     
    ![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/d0bcebe9-9dde-4855-9a97-29be5fb75737)

You can find the same UI in the Tasks detail view. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/4b337d5a-1380-492a-a0ef-e9860f5f2b1b)

### Detailed Explanation
#### Add an Association
In the DemoTask class, AssociationAttribute is applied to the Contacts property of the XPCollection type. This property represents a collection of associated Contacts. XPO uses the Association attribute to set a relationship between objects. The Contacts property getter implementation - the GetCollection method - is used to return a collection.

```csharp
[Association("Contact-DemoTask")]
public XPCollection<Contact> Contacts {
    get {
        return GetCollection<Contact>(nameof(Contacts));
    }
}
```
In the Contact class, the Tasks property is the second part of the Contact-DemoTask relationship. Note that the Association attribute must be applied to this property as well. 

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    [Association("Contact-DemoTask")]
    public XPCollection<DemoTask> Tasks {
        get {
            return GetCollection<DemoTask>(nameof(Tasks));
        }
    }
}
```

> NOTE: Do not modify the XPCollection property declaration demonstrated above. If you manipulate the collection or introduce any additional settings within the declaration, it may cause unpredictable behavior.

After you run the application, XPO will generate the intermediate tables and relationships.

#### Change Application Model in Code
The DemoTask class is decorated with the ModelDefaultAttribute attribute. The attribute parameters specify that the Caption property of the Application Model’s BOModel | DemoTask node is set to “Task”. 

You can apply the ModelDefault attribute to a business class or its member to change any property of the Application Model’s BOModel | <Class> or BOModel | <Class> | OwnMembers | <Member> node.

## Set a One-to-Many Relationship (XPO)
This lesson explains how to create a one-to-many relationship between business objects and how XAF generates the UI for such a relationship.

### Step-by-Step Instructions
1. To implement the “One” part of the Department-Contacts relationship, decorate the Contact class’ Department property with the `AssociationAttribute`.

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    private Department department;
    [Association("Department-Contacts")]
    public Department Department {
        get {return department;}
        set {SetPropertyValue(nameof(Department), ref department, value);}
    }
    //...
}
```

Refer to the following help topic for information on the Association attribute: Set a Many-to-Many Relationship (XPO).

2. To implement the “Many” part of the Department-Contacts relationship, add the Contacts property to the Department class and decorate this property with the Association attribute.

```csharp
public class Department : BaseObject {
    //...
    [Association("Department-Contacts")]
    public XPCollection<Contact> Contacts {
        get {
            return GetCollection<Contact>(nameof(Contacts));
        }
    }
}
```

3. Run the application. 

Open the Department detail view. You can see the Contacts group. To add objects to the Contacts collection, use the New or Link button in this tab. The Link button allows users to add references to existing Contact objects.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/d9a2d084-72af-4f8c-8dbc-78429f3112d1)

To remove a reference to an object from this collection, use the Unlink button.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/8493c6f9-cb49-44d9-858b-dfe0d8a5f953)

> TIP: If you create a new Department and then create a new Contact in the Contacts collection, the associated Department is not immediately visible in the Detail View of the newly created Contact. The link between these objects is added later when you save the Contact. To change this behavior, use the XafApplication.LinkNewObjectToParentImmediately property. When the property value is true, the application creates a link and saves it immediately after you click New.

## Initialize Business Object Properties (XPO)
This lesson explains how to initialize properties in newly created business objects. 

For this purpose, you will add the Priority property to the DemoTask class created in the Set a Many-to-Many Relationship (XPO) lesson. Then you will override the AfterConstruction method to initialize the new property.

### Step-by-Step Instructions
1. Add the Priority property to the DemoTask class and declare the Priority enumeration, as shown below:

```csharp
public class DemoTask : Task {
    // ...
    private Priority priority;
    public Priority Priority {
        get { return priority; }
        set {
            SetPropertyValue(nameof(Priority), ref priority, value);
        }
    }
    //...
}
public enum Priority {
    Low,
    Normal,
    High
}
```

2. To initialize the newly added Priority property when a DemoTask object is created, override the AfterConstruction method, as shown below:

```csharp
[DefaultClassOptions]
[ModelDefault("Caption", "Task")]
public class DemoTask : Task {
    //...
    public override void AfterConstruction() {
        base.AfterConstruction();
        Priority = Priority.Normal;
    }
    //...
}
```

3. Run the application. 

Create a new DemoTask object. In the Task detail view, the Priority property is set to Priority.Normal, as declared in the code above. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/028a003f-95b9-46ea-844b-65679dc4cc9a)

Note that XAF generates a combo box for the Priority property. The combo box items are the enumeration values declared in the step 2.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/284d1c95-1e8a-489e-abe9-f9af6a7fa25c)

### Detailed Explanation
#### Initialize Property Values
The AfterConstruction method is executed when a new business object is created. In this tutorial, you override this method to set the Priority property to Priority.Normal when a new DemoTask object is created. 

## Implement Dependent Reference Properties (XPO)
This lesson explains how to implement properties whose values can depend on other properties. 

You will add a new Manager property to the Contact class. The editor for this property will display a list of managers who work in the same department.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/93ad42c2-800e-476b-bd11-994f5c185bd7)

### Step-by-Step Instructions
1. Add a new Manager property of the Contact type to the Contact class. 

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    private Contact manager;
    public Contact Manager {
       get { return manager; }
       set { SetPropertyValue(nameof(Manager), ref manager, value); }
    }
    //...
}
```

2. Apply the DataSourceProperty and DataSourceCriteria attributes to the newly added property.

```csharp
[DefaultClassOptions]
public class Contact : Person {
    //...
    [DataSourceProperty("Department.Contacts", DataSourcePropertyIsNullMode.SelectAll)]
    [DataSourceCriteria("Position.Title = 'Manager' AND Oid != '@This.Oid'")]
    public Contact Manager {
        // ...
    }
    // ...
}
```

3. Run the application.

Add the following objects:

* a Department object (for example, “Developer Department”) 
* multiple Contact objects with the Department property set to “Developer Department” 
* multiple Position objects (for example, “Manager”, “Developer”). 

For the newly added contacts, set the Position property to:

* “Manager” (for multiple Contact objects); 
* “Developer” (for other Contact objects). 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/54f71b21-1d0f-46c3-8ee6-1453220c3728)

Create a new Contact object. In the Contact Detail View, specify the Department property and expand the Manager lookup editor. Notice the following:

* The Department property of the listed objects is the same as those you specified above. 
* The Position property is set to “Manager” for each of the listed objects. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/62b8a8de-45b9-4c09-9c66-158c798459f6)

### Detailed Explanation
You can use integrated XAF designers to implement the same behavior without code. For details, refer to the following lesson: Filter Data Source for a Lookup Editor.

#### The DataSourceProperty Attribute
The DataSourceProperty attribute accepts two parameters. The first one specifies the path to the lookup list. The second parameter is optional. It specifies how the lookup items are populated if the application could not find any items from the path.

In this tutorial, the second parameter is set to SelectAll. You can also set the SelectNothing or CustomCriteria values. In the latter case, a third parameter is required to specify criteria.

#### The DataSourceCriteria Attribute
With the DataSourceCriteria attribute applied, the Manager lookup editor contains Contact objects that satisfy the criteria specified in the attribute parameter.

## Implement Property Value Validation in Code (XPO)
This lesson explains how to set validation rules for business classes and their properties. XAF applies these rules when a user executes the specified operation (for example, saves an edited object). 

In this lesson you will create a rule that requires that the Position.Title property must not be empty. The application will apply the rule when a user saves a Position object. 

> NOTE:
> To use XAF Validation functionality, install the DevExpress.ExpressApp.Validation.Blazor NuGet package and register the Validation module in your project. 
The project wizard adds this package to all new applications with the enabled security options.

### Step-by-Step Instructions
1. Apply the RuleRequiredFieldAttribute attribute to the Title property in the Position class. As a parameter, specify the context that triggers the rule (for example, DefaultContexts.Save):

```csharp
using DevExpress.Persistent.Validation;
//...
[DefaultClassOptions]
[System.ComponentModel.DefaultProperty(nameof(Title))]
public class Position : BaseObject {
   //...
   private string title;
   [RuleRequiredField(DefaultContexts.Save)]
   public string Title {
      get { return title; }
      set { SetPropertyValue(nameof(Title), ref title, value); }
   }
}
```

2. Run the application. 

Click the New button to create a new Position object. Leave the Title property empty and click Save. The error message is displayed:

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/e0856a00-3a74-4173-a916-f7f028d3f018)

### Detailed Explanation
The RuleRequiredField attribute defines a validation rule that ensures that the Position.Title property has a value when the Position object is saved.

The Validation System offers a number of Rules and Contexts. For details, refer to the Validation Rules topic. The Application Model stores all rules so that an admin can add and edit Rules and Contexts with the Model Editor (see the Implement Property Value Validation in the Application Model topic).

## Filter Data Source for a Lookup Editor (XPO)
This lesson explains how to filter data displayed in a lookup editor. This editor appears in a Detail View for reference properties and contains a list of objects of another related class. 

### Step-by-Step Instructions
1. Specify a Many-to-Many relationship between the Position and Department classes. For more information, refer to the following topic: Set a Many-to-Many Relationship (XPO).

```csharp
[DefaultClassOptions]
[System.ComponentModel.DefaultProperty(nameof(Title))]
 public class Department : BaseObject {
   //...
   [Association("Departments-Positions")]
   public XPCollection<Position> Positions {
      get { return GetCollection<Position>(nameof(Positions)); }
   }
}

[DefaultClassOptions]
[System.ComponentModel.DefaultProperty(nameof(Title))]
public class Position : BaseObject {
      //...
   [Association("Departments-Positions")]
   public XPCollection<Department> Departments {
      get { return GetCollection<Department>(nameof(Departments)); }
   }
}
```

2. Open the Model.DesignedDiffs.xafml file in the Model Editor. Navigate to the BOModel | MySolution.Module.BusinessObjects node. Expand the Contact child node and select the OwnMembers | Position child node. 

Make the following changes to the node’s properties:

* Set the DataSourceProperty property to Department.Positions. 
* Set the DataSourcePropertyIsNullMode property to SelectAll.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/6ee2b286-3344-4acd-8723-61c8c49d4dd9)

3. In the Contact class (BusinessObjects\Contact.cs), replace the Department property declaration with the following code:

```csharp
[Association("Department-Contacts", typeof(Department)), ImmediatePostData]
public Department Department {
   get {return department;}
   set {
      SetPropertyValue(nameof(Department), ref department, value);
       // Clear Position and Manager properties if the Department has changed.
      if(!IsLoading) {
         Position = null;
         if(Manager != null && Manager.Department != value) {
            Manager = null;
         }
      }
   }
}
```

4.Run the application. Open a department’s Detail View and Link several Position items to this department.

5. Open the Detail View of a contact that belongs to this department. The Position editor dropdown lists the positions you linked in the previous step:

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/65d0ea49-7e55-4d96-9020-8102707c286a)
