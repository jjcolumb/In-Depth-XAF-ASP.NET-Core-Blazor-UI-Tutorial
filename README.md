# In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial

While we continue to extend the capabilities of XAF’s ASP.NET Core Blazor UI, you can deliver intuitive user experiences for the ASP.NET Core Blazor platform today. This tutorial documents how to build an application to store contacts and other related objects using XAF’s ASP.NET Core Blazor UI. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/9792ce26-5370-4919-bb95-eeefe1cc834b)

If you are new to XAF, be sure to review our XAF product page for important background information on our award-winning application framework.

## Dependencies and Prerequisites
Before you start the tutorial, read this section and ensure that the following conditions are met: 

1. Visual Studio 2022 v17.0+ (with the ASP.NET and web development workload) is installed on your machine. You have basic experience of .NET framework development in this IDE. 
2. .NET 6 SDK is installed on your machine. 
3. A free 30-day trial version or a licensed version of DevExpress Universal Subscription is installed on your machine. 
4. You have basic knowledge of Object-relational mapping (ORM) concepts and the DevExpress XPO. 
5. Any RDBMS supported by the XPO ORM tool (see Database Systems Supported by XPO) is installed and accessible from your machine to store the application data (a LocalDB or SQL Server Express instance is recommended). 
6. You are familiar with XAF application architecture. 

## Tutorial Structure
This tutorial is organized in the following manner: 

* Business Model Design

This section explains how to implement classes that define the foundation of your application’s business model and its associated database structure.

* Extend Functionality

This section explains how to extend XAF’s autogenerated UI with custom commands.

* UI Customization

This section explains how to customize XAF’s autogenerated ASP.NET Core Blazor application UI.

## Connection String
This tutorial uses Microsoft’s SQL Server as its target database management system (DBMS). As you may already know, XAF supports multiple database management systems (see the list here). If you’d like to use a different DBMS, be sure to specify the appropriate connection string.

XAF apps create a database with a name that matches the name used for the solution itself. To change names, edit the connection string in the application configuration file (appsettings.json).

To recreate your database, drop it from the database server or remove the file. Your XAF application will recreate the database at next startup.

# Business Model Design
This section explains how to design a business model (database) for an application built with the eXpressApp Framework. 

You will learn how to complete the following tasks:

* Create business classes mapped to database tables 
* Specify relationships between classes 
* Implement dependent properties 
* Add property value validation 

You can design a business model in any of the following ways:

* Use the DevExpress Business Class Library

The Business Class Library includes frequently used business classes, such as Person, Event, Task, etc. You can use a class from this library as is, or inherit and extend it.

* Build Custom Classes

If you use XPO, inherit your business objects from Base Persistent Classes.

> TIP: For information on how to build an application based on an existing database, refer to the following topic: How to: Generate XPO Business Classes for Existing Data Tables.

Once you complete the tutorial, your basic ASP.NET Core Blazor CRUD application will look as shown in the image below.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/c2e7c254-8cb0-4e34-a0e4-f9cbb1469e86)

## Create a Solution (XPO)
This lesson creates a new XAF solution and guides you through the XAF Solution Wizard. In the Wizard, you will do the following: 

* Add a Blazor UI project to the solution. 
* Select an ORM tool to use for data management. 
* Turn on user authentication. 
* Review available built-in modules and enable the Validation module. 

At the end of this lesson, you can run the application for the first time.

### Step-by-Step Instructions
1. From Visual Studio’s main menu, select File | New | Project… to invoke the Create a new project dialog.

2. Select DevExpress v22.1 XAF Template Gallery and click Next. Specify the project’s name (“MySolution”) and click Create.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/8a2fce33-7176-428e-b60f-395a6631a938)

3. In the invoked Template Gallery window, switch to the .NET Core section. Select XAF Solution Wizard (.NET Core) and click Run Wizard.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/c1af0c11-5ed4-417e-b88e-ccce3b083f5f)

4. On the first page of the Solution Wizard, you can select the target platform. Since this tutorial only demonstrates the Blazor UI, select the Web (ASP.NET Core Blazor) option and click Next.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/445e10d7-f984-442b-bbbc-d19ae851e470)

5. Choose the DevExpress eXpress Persistent Objects ORM library.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/fe749992-2fc1-4775-9694-df100acae5a6)

6. Choose the authentication type for your application. In this tutorial, we use Standard. Click Next.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/99228f56-6d88-44dd-945f-0eaa043f4549)

7. Select the ready-to-use XAF modules you want to add to your application. This tutorial requires the Validation module. Click Finish.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/6156fc02-017d-4d36-a45b-395644c75010)

The solution contains the following projects: 

* **MySolution.Blazor.Server** - the ASP.NET Core Blazor application project that automatically generates the ASP.NET Core Blazor CRUD user interface. This project depends on the MySolution.Module. 
* **MySolution.Module** - the module project that contains platform-independent code.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/be5561d4-03f6-41fd-9af3-e6b78bba736e)
Refer to the Application Solution Structure topic for information on the XAF solution structure.

8. You can now run the application. Click Start Debugging or press F5.

The following images show the resulting ASP.NET Core Blazor application. Log in as “Admin” and use an empty string as the password.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/88c4a55c-1b4d-44ef-86ce-83febfa9a6ca)
![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/8ec3e04e-7e4c-433a-b3ad-e4cb37630036)

### Initial Connection to Database
The wizard attempts to find the installed Microsoft SQL Server instance (LocalDB or Express) and sets the connection string accordingly. 

Refer to the Connect an XAF Application to a Database Provider topic for details on how to connect to different database systems.

## Inherit from the Business Class Library Class (XPO)
In this lesson, you will learn how to implement business classes for your application using the Business Class Library. This library contains the most typical ready-to-use business classes. You will implement a custom Contact class by deriving from the Person class available in this library, and implement several additional properties. You will also learn the basics of automatic user interface construction based on data.

### Step-by-Step Instructions
1. Right-click the Business Objects folder in the MySolution.Module project, and choose Add Item | Class…, specify Contact.cs as the new class name and click Add. 
2. Replace the generated class declaration with the following code.

```csharp
using DevExpress.Persistent.Base;
using DevExpress.Persistent.BaseImpl;
using DevExpress.Persistent.Validation;
using DevExpress.Xpo;
using System;

namespace MySolution.Module.BusinessObjects {
    [DefaultClassOptions]
    public class Contact : Person {
        public Contact(Session session) : base(session) { }
        private string webPageAddress;
        public string WebPageAddress {
            get { return webPageAddress; }
            set { SetPropertyValue(nameof(WebPageAddress), ref webPageAddress, value); }
        }
        private string nickName;
        public string NickName {
            get { return nickName; }
            set { SetPropertyValue(nameof(NickName), ref nickName, value); }
        }
        private string spouseName;
        public string SpouseName {
            get { return spouseName; }
            set { SetPropertyValue(nameof(SpouseName), ref spouseName, value); }
        }
        private TitleOfCourtesy titleOfCourtesy;
        public TitleOfCourtesy TitleOfCourtesy {
            get { return titleOfCourtesy; }
            set { SetPropertyValue(nameof(TitleOfCourtesy), ref titleOfCourtesy, value); }
        }
        private DateTime anniversary;
        public DateTime Anniversary {
            get { return anniversary; }
            set { SetPropertyValue(nameof(Anniversary), ref anniversary, value); }
        }
        private string notes;
        [Size(4096)]
        public string Notes {
            get { return notes; }
            set { SetPropertyValue(nameof(Notes), ref notes, value); }
        }
    }
    public enum TitleOfCourtesy { Dr, Miss, Mr, Mrs, Ms };
}
```
3. Run the application. 

XAF generates a user interface that is based on the specified data structures: 

* a List View

List View displays the Contact list. If users click the New button or click an existing record, the application shows a detail form (Detail View) filled with editors for each data field. 

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/1f6ad8f8-24de-491d-a107-258fb41abaf1)

* a Detail View

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/9df1df0f-e219-4b2b-bea8-8f3987d9a5b1)

### Detailed Explanation
#### Convention
Typically, business classes do not depend on application UI and should be implemented in a platform-independent module project. Business objects can be shared with other XAF or non-XAF applications.

#### Add a Business Object
In this lesson, we derive the Contact object from the Person class. The Person class is one of the Business Class Library classes. This class already contains fields specific to entities of the Person type: first name, last name, birth date, etc. 

The Person class (and the rest of the Business Class Library) derives from BaseObject. The BaseObject class derives from DevExpress.Xpo.XPCustomObject - one of the base classes in XPO. This means that the Contact business object is a persistent object.

XPO requires that you implement property setters and a parameterized constructor as follows:

```csharp
[DefaultClassOptions]
public class Contact : Person {
    public Contact(Session session) : base(session) { }
    private string webPageAddress;
    public string WebPageAddress {
        get { return webPageAddress; }
        set { SetPropertyValue(nameof(WebPageAddress), ref webPageAddress, value); }
    }
    // ...
}
```
Refer to the following help topic for more information: Creating a Persistent Object.

For a general business class concept overview, refer to the following topic: Business Classes vs Database Tables.

> NOTE: CodeRush includes a number of Code Templates that help generate business classes or their parts with a few keystrokes. To learn about the Code Templates for eXpress Persistent Objects, refer to the following help topic: XPO and XAF Templates.

#### Attributes
In this tutorial the business objects class is decorated with the DefaultClassOptionsAttribute attribute. This attribute means that the following capabilities are available for the Contact business class.

* The Contact item is added to the main page’s navigation control. Users can click this item to access the associated List View. 
![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/3bdf44e6-3cbe-46c7-94ac-d94a5197ba97)

* Contact objects can be used as a data source to generate reports (see Create a Report in Visual Studio). 
To apply each of these options separately, use the `NavigationItemAttribute` and `VisibleInReportsAttribute` attributes.

#### User Interface
XAF generates the appropriate editors for data fields in the List View and Detail View. For example, a date picker is generated for date-time values, a combo box editor is created for Title Of Courtesy (an enumerator).

XAF transforms captions from camel-case to space-separated strings, form titles are updated, etc.

You can use the grid features in a List View at runtime: rearrange columns, and sort and filter data.

## Supply Initial Data (XPO)

### Step-by-Step Instructions
1. Open the Updater.cs file located in the MySolution.Module project’s Database Update folder. Add the following code to the `ModuleUpdater.UpdateDatabaseAfterUpdateSchema` method.

```csharp
using MySolution.Module.BusinessObjects;
//...

public class Updater : DevExpress.ExpressApp.Updating.ModuleUpdater {
    //...
    public override void UpdateDatabaseAfterUpdateSchema() {
        base.UpdateDatabaseAfterUpdateSchema();

        Contact contactMary = ObjectSpace.FirstOrDefault<Contact>(contact => contact.FirstName == "Mary" && contact.LastName == "Tellitson"); 
        if (contactMary == null) {
            contactMary = ObjectSpace.CreateObject<Contact>();
            contactMary.FirstName = "Mary";
            contactMary.LastName = "Tellitson";
            contactMary.Email = "tellitson@example.com";
            contactMary.Birthday = new DateTime(1980, 11, 27);
        }
        //...
        ObjectSpace.CommitChanges();
    }
}
```

2. Run the application. Select the Contact item in the navigation control. Notice that the new contact, “Mary Tellitson”, appears on the list to the right.

![image](https://github.com/jjcolumb/In-Depth-XAF-ASP.NET-Core-Blazor-UI-Tutorial/assets/126447472/d5a4946b-82a7-4e13-aba1-5c4aea715714)

### Detailed Explanation
#### Database Update
In step 1, you add a code that checks whether the contact list contains an entry that matches the name “Mary Tellitson”. If such a contact does not exist, the code creates and adds it to the database.

An XAF application checks application and database version compatibility on each start. The following checks are performed:

* The database exists. 
* All required tables exist. 
* All required columns exist. 
The `XafApplication.DatabaseVersionMismatch` event occurs if any of these checks fails.

The ASP.NET Core Blazor application handles this event in a solution template. When the application runs in debug mode, this event handler uses the built-in Database Updater to update the application’s database. After the database schema is updated, the` ModuleUpdater.UpdateDatabaseAfterUpdateSchema` method is called. In this method, you can save the required business objects to the database.

#### Query Data
As you can see in the code above, XAF uses an Object Space object to manipulate persistent objects (see Create, Read, Update and Delete Data).

